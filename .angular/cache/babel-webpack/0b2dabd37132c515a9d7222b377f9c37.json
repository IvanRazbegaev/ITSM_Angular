{"ast":null,"code":"import _asyncToGenerator from \"/home/ivan/WebstormProjects/SoftgamingITSMAngular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/tracker-backend.service\";\n\nfunction TrackerComponent_mat_expansion_panel_3_app_incident_week_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-incident-week\", 3);\n  }\n\n  if (rf & 2) {\n    const week_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"week\", week_r3)(\"data\", ctx_r2.incidentsArray);\n  }\n}\n\nfunction TrackerComponent_mat_expansion_panel_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-expansion-panel\");\n    i0.ɵɵelementStart(1, \"mat-expansion-panel-header\");\n    i0.ɵɵelementStart(2, \"mat-panel-title\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, TrackerComponent_mat_expansion_panel_3_app_incident_week_4_Template, 1, 2, \"app-incident-week\", 2);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const year_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" Issues for year \", year_r1, \", current incident week: \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.weekArray);\n  }\n}\n\nexport class TrackerComponent {\n  constructor(response) {\n    this.response = response;\n    this.isExpanded = false;\n    this.yearArray = [];\n    this.weekArray = [];\n    this.incidentsArray = [];\n    this.dayTimestamp = 24 * 60 * 60;\n  }\n\n  init() {\n    var _this = this;\n\n    this.response.getAllIncidents().subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (value) {\n        _this.incidentsArray = yield value;\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    console.log(this.incidentsArray);\n    this.parseIncidents(this.incidentsArray);\n  }\n\n  ngOnInit() {\n    this.init();\n  }\n\n  checkForIncidents() {\n    this.response.checkForIncidents().subscribe(value => {\n      console.log(value);\n    });\n    this.init();\n  }\n\n  getIncidentYear(incTime) {\n    const incTimeToTimestamp = Date.parse(String(incTime));\n    return new Date(incTimeToTimestamp).getFullYear();\n  }\n\n  getIncidentWeek(incTime) {\n    const incTimeToTimestamp = Date.parse(String(incTime));\n    const startOfTheYear = Date.parse(new Date(this.getIncidentYear(incTime), 0, 1).toJSON());\n    return Math.floor((incTimeToTimestamp - startOfTheYear) / 7 * this.dayTimestamp);\n  }\n\n  parseIncidents(incidentArray) {\n    console.log(incidentArray);\n\n    for (const incident of incidentArray) {\n      const incidentYear = this.getIncidentYear(incident.start_date);\n\n      if (this.yearArray.indexOf(incidentYear) < 0) {\n        this.yearArray.push(incidentYear);\n      }\n    }\n  }\n\n}\n\nTrackerComponent.ɵfac = function TrackerComponent_Factory(t) {\n  return new (t || TrackerComponent)(i0.ɵɵdirectiveInject(i1.TrackerBackendService));\n};\n\nTrackerComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: TrackerComponent,\n  selectors: [[\"app-tracker\"]],\n  decls: 4,\n  vars: 1,\n  consts: [[1, \"btn\", \"btn-primary\", 3, \"click\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"inactive-week\", 3, \"week\", \"data\", 4, \"ngFor\", \"ngForOf\"], [1, \"inactive-week\", 3, \"week\", \"data\"]],\n  template: function TrackerComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"button\", 0);\n      i0.ɵɵlistener(\"click\", function TrackerComponent_Template_button_click_0_listener() {\n        return ctx.checkForIncidents();\n      });\n      i0.ɵɵtext(1, \"Check for incidents\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementContainerStart(2);\n      i0.ɵɵtemplate(3, TrackerComponent_mat_expansion_panel_3_Template, 5, 2, \"mat-expansion-panel\", 1);\n      i0.ɵɵelementContainerEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngForOf\", ctx.yearArray);\n    }\n  },\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJ0cmFja2VyLmNvbXBvbmVudC5jc3MifQ== */\"]\n});","map":{"version":3,"sources":["/home/ivan/WebstormProjects/SoftgamingITSMAngular/src/app/incidents-tracker/tracker/tracker.component.ts"],"names":["i0","i1","TrackerComponent_mat_expansion_panel_3_app_incident_week_4_Template","rf","ctx","ɵɵelement","week_r3","$implicit","ctx_r2","ɵɵnextContext","ɵɵproperty","incidentsArray","TrackerComponent_mat_expansion_panel_3_Template","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵtemplate","year_r1","ctx_r0","ɵɵadvance","ɵɵtextInterpolate1","weekArray","TrackerComponent","constructor","response","isExpanded","yearArray","dayTimestamp","init","getAllIncidents","subscribe","value","console","log","parseIncidents","ngOnInit","checkForIncidents","getIncidentYear","incTime","incTimeToTimestamp","Date","parse","String","getFullYear","getIncidentWeek","startOfTheYear","toJSON","Math","floor","incidentArray","incident","incidentYear","start_date","indexOf","push","ɵfac","TrackerComponent_Factory","t","ɵɵdirectiveInject","TrackerBackendService","ɵcmp","ɵɵdefineComponent","type","selectors","decls","vars","consts","template","TrackerComponent_Template","ɵɵlistener","TrackerComponent_Template_button_click_0_listener","ɵɵelementContainerStart","ɵɵelementContainerEnd","styles"],"mappings":"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","sourcesContent":["import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/tracker-backend.service\";\nfunction TrackerComponent_mat_expansion_panel_3_app_incident_week_4_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelement(0, \"app-incident-week\", 3);\n} if (rf & 2) {\n    const week_r3 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"week\", week_r3)(\"data\", ctx_r2.incidentsArray);\n} }\nfunction TrackerComponent_mat_expansion_panel_3_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-expansion-panel\");\n    i0.ɵɵelementStart(1, \"mat-expansion-panel-header\");\n    i0.ɵɵelementStart(2, \"mat-panel-title\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, TrackerComponent_mat_expansion_panel_3_app_incident_week_4_Template, 1, 2, \"app-incident-week\", 2);\n    i0.ɵɵelementEnd();\n} if (rf & 2) {\n    const year_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" Issues for year \", year_r1, \", current incident week: \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.weekArray);\n} }\nexport class TrackerComponent {\n    constructor(response) {\n        this.response = response;\n        this.isExpanded = false;\n        this.yearArray = [];\n        this.weekArray = [];\n        this.incidentsArray = [];\n        this.dayTimestamp = 24 * 60 * 60;\n    }\n    init() {\n        this.response.getAllIncidents()\n            .subscribe(async (value) => {\n            this.incidentsArray = await value;\n        });\n        console.log(this.incidentsArray);\n        this.parseIncidents(this.incidentsArray);\n    }\n    ngOnInit() {\n        this.init();\n    }\n    checkForIncidents() {\n        this.response.checkForIncidents()\n            .subscribe(value => {\n            console.log(value);\n        });\n        this.init();\n    }\n    getIncidentYear(incTime) {\n        const incTimeToTimestamp = Date.parse(String(incTime));\n        return new Date(incTimeToTimestamp).getFullYear();\n    }\n    getIncidentWeek(incTime) {\n        const incTimeToTimestamp = Date.parse(String(incTime));\n        const startOfTheYear = Date.parse(new Date(this.getIncidentYear(incTime), 0, 1).toJSON());\n        return Math.floor((incTimeToTimestamp - startOfTheYear) / 7 * this.dayTimestamp);\n    }\n    parseIncidents(incidentArray) {\n        console.log(incidentArray);\n        for (const incident of incidentArray) {\n            const incidentYear = this.getIncidentYear(incident.start_date);\n            if (this.yearArray.indexOf(incidentYear) < 0) {\n                this.yearArray.push(incidentYear);\n            }\n        }\n    }\n}\nTrackerComponent.ɵfac = function TrackerComponent_Factory(t) { return new (t || TrackerComponent)(i0.ɵɵdirectiveInject(i1.TrackerBackendService)); };\nTrackerComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: TrackerComponent, selectors: [[\"app-tracker\"]], decls: 4, vars: 1, consts: [[1, \"btn\", \"btn-primary\", 3, \"click\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"inactive-week\", 3, \"week\", \"data\", 4, \"ngFor\", \"ngForOf\"], [1, \"inactive-week\", 3, \"week\", \"data\"]], template: function TrackerComponent_Template(rf, ctx) { if (rf & 1) {\n        i0.ɵɵelementStart(0, \"button\", 0);\n        i0.ɵɵlistener(\"click\", function TrackerComponent_Template_button_click_0_listener() { return ctx.checkForIncidents(); });\n        i0.ɵɵtext(1, \"Check for incidents\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementContainerStart(2);\n        i0.ɵɵtemplate(3, TrackerComponent_mat_expansion_panel_3_Template, 5, 2, \"mat-expansion-panel\", 1);\n        i0.ɵɵelementContainerEnd();\n    } if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.yearArray);\n    } }, styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJ0cmFja2VyLmNvbXBvbmVudC5jc3MifQ== */\"] });\n"]},"metadata":{},"sourceType":"module"}